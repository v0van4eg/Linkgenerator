<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Хостинг картинок</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="upload-section">
            <h1>Загрузка изображений</h1>

            {% if error %}
            <div class="error">{{ error }}</div>
            {% endif %}

            <form method="POST" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="client_name">Имя клиента:</label>
                    <input type="text" id="client_name" name="client_name"
                           value="{{ client_name or '' }}" required>
                </div>

                <div class="form-group">
                    <label for="product_name">Имя товара:</label>
                    <input type="text" id="product_name" name="product_name"
                           value="{{ product_name or '' }}" required>
                </div>

                <div class="form-group">
                    <label for="images">Изображения:</label>
                    <input type="file" id="images" name="images"
                           multiple accept="image/*" required>
                </div>

                <button type="submit" class="btn">Загрузить изображения</button>
            </form>
        </div>

        <div class="links-section">
            <h1>Сгенерированные ссылки</h1>

            {% if image_urls %}
            <div class="url-list" id="urlList">
                {% for url in image_urls %}
                <div class="url-item">
                    <div class="url-text">{{ url }}</div>
                    <div class="url-actions">
                        <button class="btn" onclick="copyToClipboard('{{ url }}')">
                            Копировать
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>

            <div class="bulk-actions">
                <button class="btn btn-secondary" onclick="downloadAllLinks()">
                    Скачать все ссылки (TXT)
                </button>
                <button class="btn btn-secondary" onclick="copyAllToClipboard()">
                    Копировать все ссылки
                </button>
            </div>
            {% else %}
            <p>Загрузите изображения, чтобы увидеть ссылки</p>
            {% endif %}
        </div>
    </div>

    <script>
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                alert('Ссылка скопирована в буфер обмена!');
            }, function(err) {
                // Fallback для старых браузеров
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Ссылка скопирована в буфер обмена!');
            });
        }

        function copyAllToClipboard() {
            const urlItems = document.querySelectorAll('.url-text');
            const allUrls = Array.from(urlItems).map(item => item.textContent);
            const text = allUrls.join(', ');
            copyToClipboard(text);
        }

        function downloadAllLinks() {
            const urlItems = document.querySelectorAll('.url-text');
            const allUrls = Array.from(urlItems).map(item => item.textContent);

            if (allUrls.length === 0) {
                alert('Нет ссылок для скачивания');
                return;
            }

            // Создаем URL параметры для передачи ссылок
            const params = new URLSearchParams();
            allUrls.forEach(url => params.append('urls', url));

            // Скачиваем файл
            window.location.href = '/download-links?' + params.toString();
        }
    </script>
</body>
</html>
